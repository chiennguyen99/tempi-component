import { useStore } from '../contexts/StoreContext.es.js';

const useInjectDynamicLinks = (text, trackingAttr) => {
  const { mappingWebsiteMenuHref } = useStore();
  const formatText = () => {
    let baseText = text;
    if (text && trackingAttr)
      baseText = text.replace(
        /<a(.*?)<\/a>/g,
        `<span ${trackingAttr}><a$1</a></span>`
      );
    if (!text || !mappingWebsiteMenuHref)
      return baseText;
    return baseText.replace(
      new RegExp('(?<start><a[^>]+data-page-id=)"(?<pageId>[a-zA-Z0-9]+)"(?<end>[^>]*>)', "g"),
      (string, start, pageId, end) => {
        const href = mappingWebsiteMenuHref[pageId];
        if (!href)
          return string;
        return `${start}"${pageId}" href="${href}"${end}`;
      }
    );
  };
  return {
    text: formatText()
  };
};

export { useInjectDynamicLinks };

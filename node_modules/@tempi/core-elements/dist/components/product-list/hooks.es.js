import { t } from '../../i18n.es.js';
import { useState } from 'react';
import { useStore, publicBffUrl } from '@tempi/core-renderer';
import { inputsConfig } from './constants.es.js';
import { queryStringToObject } from '../../utils/queryStringToObject.es.js';
import { getPartialDateTimeTimeZone7 } from '../../utils/getPartialDateTimeTimeZone7.es.js';
import { transformValuesGGSheet } from '../../utils/transformValueGGSheet.es.js';
import { formUtils } from '../../utils/form.es.js';

var __defProp = Object.defineProperty;
var __getOwnPropSymbols = Object.getOwnPropertySymbols;
var __hasOwnProp = Object.prototype.hasOwnProperty;
var __propIsEnum = Object.prototype.propertyIsEnumerable;
var __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: true, configurable: true, writable: true, value }) : obj[key] = value;
var __spreadValues = (a, b) => {
  for (var prop in b || (b = {}))
    if (__hasOwnProp.call(b, prop))
      __defNormalProp(a, prop, b[prop]);
  if (__getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(b)) {
      if (__propIsEnum.call(b, prop))
        __defNormalProp(a, prop, b[prop]);
    }
  return a;
};
var __objRest = (source, exclude) => {
  var target = {};
  for (var prop in source)
    if (__hasOwnProp.call(source, prop) && exclude.indexOf(prop) < 0)
      target[prop] = source[prop];
  if (source != null && __getOwnPropSymbols)
    for (var prop of __getOwnPropSymbols(source)) {
      if (exclude.indexOf(prop) < 0 && __propIsEnum.call(source, prop))
        target[prop] = source[prop];
    }
  return target;
};
const useCheckout = (configStorage) => {
  const { env } = useStore();
  const [selectedProduct, setSelectedProduct] = useState();
  const [loading, setLoading] = useState(false);
  const [doneCheckout, setDoneCheckout] = useState(false);
  const handleFinishCheckout = async (values) => {
    var _b;
    try {
      setLoading(true);
      const _a = queryStringToObject(window.location.search) || {}, {
        utm_source,
        utm_medium,
        utm_campaign,
        utm_term,
        utm_content
      } = _a, rest = __objRest(_a, [
        "utm_source",
        "utm_medium",
        "utm_campaign",
        "utm_term",
        "utm_content"
      ]);
      const newValues = __spreadValues(__spreadValues({
        utm_source,
        utm_medium,
        utm_campaign,
        utm_term,
        utm_content
      }, (configStorage == null ? void 0 : configStorage.autoPassParams) && rest), values);
      const date = new Date();
      const { year, month, day, hour, minute, second } = getPartialDateTimeTimeZone7(date);
      const dateString = `${year}-${month}-${day} ${hour}:${minute}:${second}`;
      let valuesSubmit = transformValuesGGSheet(newValues, inputsConfig);
      valuesSubmit = [
        ...valuesSubmit,
        {
          name: t("T\xEAn s\u1EA3n ph\u1EA9m"),
          type: "string",
          value: selectedProduct == null ? void 0 : selectedProduct.name
        },
        {
          name: t("Gi\xE1 b\xE1n"),
          type: "number",
          value: selectedProduct == null ? void 0 : selectedProduct.price
        },
        {
          name: t("Th\u1EDDi gian g\u1EEDi"),
          type: "string",
          value: dateString
        },
        {
          name: t("G\u1EEDi t\u1EEB URL"),
          type: "string",
          value: (_b = window == null ? void 0 : window.location) == null ? void 0 : _b.href
        }
      ];
      await formUtils.submitFormData(
        configStorage == null ? void 0 : configStorage.formConfigId,
        valuesSubmit,
        `${publicBffUrl[env]}/v1/submit-form`
      );
      setSelectedProduct(void 0);
      setDoneCheckout(true);
    } finally {
      setLoading(false);
    }
  };
  return {
    loading,
    handleFinishCheckout,
    selectedProduct,
    setSelectedProduct,
    doneCheckout,
    setDoneCheckout
  };
};

export { useCheckout };

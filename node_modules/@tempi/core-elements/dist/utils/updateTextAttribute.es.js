import { APPLY_TO_NODE_BLOCK, NODE_TYPES } from '../configs/TipTapEditor/constants.es.js';

const updateTextAttribute = (commandProps, nodeTypes, attribute) => {
  const {
    commands,
    chain,
    state: { tr }
  } = commandProps;
  if (tr.getMeta(APPLY_TO_NODE_BLOCK)) {
    return nodeTypes.filter(
      (type) => [
        NODE_TYPES.listItem,
        NODE_TYPES.heading,
        NODE_TYPES.paragraph,
        NODE_TYPES.textStyle
      ].includes(type)
    ).every((type) => {
      const appliedAttrs = attribute;
      if (type === NODE_TYPES.textStyle) {
        for (const key in appliedAttrs) {
          appliedAttrs[key] = null;
        }
      }
      return chain().updateAttributes(type, appliedAttrs).setTextSelection({
        from: tr.selection.from,
        to: tr.selection.to
      }).run();
    });
  }
  return commands.setMark(NODE_TYPES.textStyle, attribute);
};

export { updateTextAttribute };
